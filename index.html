<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Audioguide der Ev. Stadtkirche von Hessisch Lichtenau</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <meta name="theme-color" content="#0a0a0a">
  <style>
    :root{
      --bg:#0a0a0a; --fg:#f5f5f5; --muted:#9ca3af; --line:#1f2937; --accent:#3b82f6;
      --radius:14px; --pad:14px; --bottomSafe:calc(env(safe-area-inset-bottom,0px));
      --bottomBarH:86px; /* H√∂he der fixen Progress-Leiste */
    }
    @media (prefers-color-scheme:light){
      :root{ --bg:#ffffff; --fg:#0a0a0a; --muted:#4b5563; --line:#e5e7eb; --accent:#2563eb; }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,"Helvetica Neue",Arial;
      background:var(--bg); color:var(--fg); -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
      padding-bottom: calc(var(--bottomBarH) + var(--bottomSafe) + 8px); /* Platz f√ºr fixe Leiste */
    }
    .wrap{max-width:640px;margin:0 auto;padding:var(--pad);display:flex;flex-direction:column;gap:12px}
    header{display:flex;align-items:center;justify-content:space-between;gap:8px;min-height:48px}
    h1{font-size: clamp(17px,4.2vw,21px); margin:0}
    .sub{color:var(--muted); font-size:clamp(12px,3.2vw,13px); line-height:1.2}
    /* Sprachauswahl ‚Äì sehr kompakt und bruchsicher */
    .lang{
      display:inline-flex; border:1px solid var(--line); border-radius:999px; overflow:hidden; flex-shrink:0;
      gap:0; background:transparent;
    }
    .lang button{
      padding:4px 8px; border:0; background:transparent; color:var(--muted);
      cursor:pointer; font-weight:700; display:flex; align-items:center; gap:6px;
      font-size:12px; line-height:1; min-width:auto;
    }
    .lang button span{letter-spacing:.02em}
    .lang button.active{ color:var(--fg); background:var(--line); }
    .card{border:1px solid var(--line); border-radius:var(--radius); padding:12px; display:flex; flex-direction:column; gap:10px}
    /* --- Controls --- */
    .controls{
      display:grid; grid-template-columns:auto 1fr; align-items:center; gap:8px; width:100%;
    }
    .play{
      width:56px;height:56px;border-radius:12px;border:0;cursor:pointer;background:var(--accent);color:white;display:grid;place-items:center;
      flex:0 0 auto;
    }
    .icon{width:24px;height:24px}
    .nav{
      justify-self:start;
      display:inline-flex; gap:6px; border:1px solid var(--line); border-radius:12px; padding:6px;
    }
    .nav button{border:0;background:transparent;color:var(--fg);cursor:pointer;padding:6px 8px;border-radius:8px;font-weight:700;font-size:13px}
    .nav button:hover{background:var(--line)}

    .speed{
      display:inline-flex; align-items:center; gap:6px; border:1px solid var(--line); border-radius:12px; padding:6px 8px; width:100%;
      justify-content:flex-start;
    }
    .speed span{font-weight:800; font-size:13px; color:var(--fg)}
    .speed button{border:0;background:transparent;color:var(--fg);cursor:pointer;padding:6px 8px;border-radius:8px;font-size:13px}
    .speed button:hover{background:var(--line)}

    /* --- Fixe Progress-Leiste unten --- */
    .bottom{
      position:fixed; left:0; right:0; bottom:0;
      padding:10px 12px calc(10px + var(--bottomSafe));
      background:rgba(20,20,20,.65);
      backdrop-filter: blur(8px);
      border-top:1px solid var(--line);
      z-index:50;
    }
    @media (prefers-color-scheme:light){
      .bottom{ background:rgba(255,255,255,.7) }
    }
    .progress{width:100%;height:12px;border-radius:999px;background:var(--line);position:relative;cursor:pointer}
    .bar{position:absolute;left:0;top:0;height:100%;width:0%;background:var(--accent);border-radius:999px}
    .thumb{position:absolute;top:50%;transform:translate(-50%,-50%);width:18px;height:18px;border-radius:50%;background:var(--accent)}
    .times{display:flex;justify-content:space-between;color:var(--muted);font-size:12px;margin-top:6px}

    /* Copyright */
    .copy{
      text-align:center; font-size:12px; margin-top:6px; color:var(--muted); opacity:.7;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    /* Extra kompakt auf sehr kleinen Ger√§ten */
    @media (max-width:360px){
      .play{width:52px;height:52px}
      .lang button{padding:4px 7px;font-size:11px}
      .nav button,.speed button{padding:5px 6px;font-size:12px}
      .speed span{font-size:12px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1 id="i-title">Audioguide der Ev. Stadtkirche von Hessisch Lichtenau</h1>
        <div class="sub" id="i-sub">Evangelische Stadtkirche ¬∑ Hessisch Lichtenau</div>
      </div>
      <div class="lang" role="tablist" aria-label="Sprache / Language">
        <button id="btn-de" role="tab" aria-selected="true" class="active">üá©üá™ <span>DE</span></button>
        <button id="btn-en" role="tab" aria-selected="false">üá¨üáß <span>EN</span></button>
      </div>
    </header>

    <section class="card" aria-label="Player">
      <!-- Reihe 1: Play + Navigation -->
      <div class="controls">
        <button id="btn-play" class="play" aria-label="Abspielen">
          <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
            <path id="icon-play" d="M8 5v14l11-7-11-7z"/>
            <path id="icon-pause" d="M6 5h4v14H6zM14 5h4v14h-4z" style="display:none"/>
          </svg>
        </button>

        <div class="nav" aria-label="Navigation">
          <button id="back15" aria-label="15 Sekunden zur√ºck">‚è™ 15s</button>
          <button id="fwd30" aria-label="30 Sekunden vor">30s ‚è©</button>
        </div>
      </div>

      <!-- Reihe 2: Tempo -->
      <div class="speed" aria-label="Wiedergabegeschwindigkeit">
        <span id="i-speed">Tempo</span>
        <button data-rate="0.8">0.8√ó</button>
        <button data-rate="1" class="rate-active" style="font-weight:800;text-decoration:underline">1√ó</button>
        <button data-rate="1.1">1.1√ó</button>
        <button data-rate="1.25">1.25√ó</button>
      </div>
    </section>
  </div>

  <!-- Fixe Progress-/Scrub-Leiste unten -->
  <div class="bottom" aria-label="Wiedergabefortschritt">
    <div class="progress" id="progress">
      <div class="bar" id="bar"></div>
      <div class="thumb" id="thumb" style="left:0%"></div>
    </div>
    <div class="times">
      <span id="cur">0:00</span>
      <span id="dur">0:00</span>
    </div>
    <div class="copy">¬© <span id="year"></span> Evangelische Stadtkirche Hessisch Lichtenau ‚Ä¢ Audioguide</div>
  </div>

  <audio id="audio" preload="metadata"></audio>

  <script>
    (()=> {
      // Lokale Dateien im selben Ordner
      const files = {
        de: "Audioguide Stadtkirche (deutsch).mp3",
        en: "Audioguide Stadtkirche (englisch).mp3"
      };

      // UI-Texte
      const i18n = {
        de: {
          title: "Audioguide der Ev. Stadtkirche von Hessisch Lichtenau",
          sub: "Evangelische Stadtkirche ¬∑ Hessisch Lichtenau",
          speed: "Tempo",
          foot: "Evangelische Stadtkirche Hessisch Lichtenau ¬∑ Audioguide",
          aria: { play:"Abspielen", pause:"Pause", back:"15 Sekunden zur√ºck", fwd:"30 Sekunden vor" }
        },
        en: {
          title: "Audio Guide of the Evangelical Town Church of Hessisch Lichtenau",
          sub: "Evangelical Town Church ¬∑ Hessisch Lichtenau",
          speed: "Speed",
          foot: "Evangelical Town Church Hessisch Lichtenau ¬∑ Audio Guide",
          aria: { play:"Play", pause:"Pause", back:"Back 15 seconds", fwd:"Forward 30 seconds" }
        }
      };

      // Elemente
      const audio   = document.getElementById("audio");
      const btnPlay = document.getElementById("btn-play");
      const iconPlay= document.getElementById("icon-play");
      const iconPause=document.getElementById("icon-pause");

      const btnDe   = document.getElementById("btn-de");
      const btnEn   = document.getElementById("btn-en");

      const iTitle  = document.getElementById("i-title");
      const iSub    = document.getElementById("i-sub");
      const iSpeed  = document.getElementById("i-speed");

      const back15  = document.getElementById("back15");
      const fwd30   = document.getElementById("fwd30");
      const rateBtns= Array.from(document.querySelectorAll("[data-rate]"));

      const progress= document.getElementById("progress");
      const bar     = document.getElementById("bar");
      const thumb   = document.getElementById("thumb");
      const cur     = document.getElementById("cur");
      const dur     = document.getElementById("dur");

      document.getElementById("year").textContent = new Date().getFullYear();

      const fmt = s => {
        if (isNaN(s) || !isFinite(s)) return "0:00";
        const m = Math.floor(s/60), sec = Math.floor(s%60).toString().padStart(2,"0");
        return `${m}:${sec}`;
      };

      const getLang = ()=>{
        const q = new URL(location.href).searchParams.get("lang");
        const s = (()=>{try{return localStorage.getItem("hl-lang")}catch(e){return null}})();
        return (q==="de"||q==="en") ? q : (s||"de");
      };

      let lang = getLang();
      const t = ()=> i18n[lang];

      // Haptik
      function vibrate(pattern){ if (navigator.vibrate) { try { navigator.vibrate(pattern); } catch(e){} } }
      const haptic = {
        tap: ()=> vibrate(10),
        success: ()=> vibrate([12,40,18]),
        pause: ()=> vibrate([8,40,8]),
        skip: ()=> vibrate([6,40,10]),
        seek: ()=> vibrate(5)
      };

      function applyI18n(){
        const tr = t();
        iTitle.textContent  = tr.title;
        iSub.textContent    = tr.sub;
        iSpeed.textContent  = tr.speed;
        btnPlay.setAttribute("aria-label", audio.paused ? tr.aria.play : tr.aria.pause);
        back15.setAttribute("aria-label", tr.aria.back);
        fwd30.setAttribute("aria-label", tr.aria.fwd);
        document.documentElement.lang = lang;
        document.title = tr.title;
      }

      function updateProgressUI(){
        if(!audio.duration) return;
        const pct = (audio.currentTime / audio.duration) * 100;
        bar.style.width = pct + "%";
        thumb.style.left = pct + "%";
        cur.textContent = fmt(audio.currentTime);
        dur.textContent = fmt(audio.duration);
      }

      function updatePlayIcon(paused){
        if(paused){
          iconPlay.style.display="block"; iconPause.style.display="none";
          btnPlay.setAttribute("aria-label", t().aria.play);
        }else{
          iconPlay.style.display="none"; iconPause.style.display="block";
          btnPlay.setAttribute("aria-label", t().aria.pause);
        }
      }

      function setSource(){
        audio.src = (lang==="de") ? files.de : files.en;
        bar.style.width="0%"; thumb.style.left="0%"; cur.textContent="0:00"; dur.textContent="0:00";
        audio.load();
      }

      async function startPlayback(){
        try{
          await audio.play();
          updatePlayIcon(false);
          haptic.success();
        }catch(e){
          updatePlayIcon(true);
        }
      }

      function setLanguage(next, push=true){
        lang = (next==="en") ? "en" : "de";
        btnDe.classList.toggle("active", lang==="de");
        btnEn.classList.toggle("active", lang==="en");
        btnDe.setAttribute("aria-selected", lang==="de");
        btnEn.setAttribute("aria-selected", lang==="en");

        setSource();
        applyI18n();

        try{ localStorage.setItem("hl-lang", lang); }catch(e){}
        if(push){
          const u = new URL(location.href); u.searchParams.set("lang", lang);
          history.replaceState(null,"",u.toString());
        }
        // Autoplay nach Sprachwechsel
        startPlayback();
      }

      // Init
      setSource();
      applyI18n();

      // Events
      btnDe.addEventListener("click", ()=> { haptic.tap(); setLanguage("de"); });
      btnEn.addEventListener("click", ()=> { haptic.tap(); setLanguage("en"); });

      btnPlay.addEventListener("click", async ()=>{
        if(audio.paused){ await startPlayback(); }
        else { audio.pause(); updatePlayIcon(true); haptic.pause(); }
      });

      back15.addEventListener("click", ()=>{
        audio.currentTime = Math.max(0, audio.currentTime - 15);
        updateProgressUI(); haptic.skip();
      });
      fwd30.addEventListener("click", ()=>{
        audio.currentTime = Math.min(audio.duration || audio.currentTime+30, audio.currentTime + 30);
        updateProgressUI(); haptic.skip();
      });

      audio.addEventListener("loadedmetadata", ()=> updateProgressUI());
      audio.addEventListener("timeupdate", ()=> updateProgressUI());
      audio.addEventListener("ended", ()=> updatePlayIcon(true));

      // Scrub / Seek (Klick & Drag, Maus + Touch)
      let seeking = false;

      function pctFromEvent(e){
        const r = progress.getBoundingClientRect();
        const x = (e.touches ? e.touches[0].clientX : e.clientX) - r.left;
        return Math.min(Math.max(0, x / r.width), 1);
      }
      function seekToPct(p){
        if(!audio.duration) return;
        audio.currentTime = p * audio.duration;
        updateProgressUI();
      }

      progress.addEventListener("mousedown", e=>{ seeking=true; seekToPct(pctFromEvent(e)); haptic.seek(); });
      progress.addEventListener("touchstart", e=>{ seeking=true; seekToPct(pctFromEvent(e)); haptic.seek(); }, {passive:true});
      window.addEventListener("mousemove", e=>{ if(seeking){ seekToPct(pctFromEvent(e)); }});
      window.addEventListener("touchmove", e=>{ if(seeking){ seekToPct(pctFromEvent(e)); }}, {passive:true});
      window.addEventListener("mouseup",   ()=>{ if(seeking){ seeking=false; }});
      window.addEventListener("touchend",  ()=>{ if(seeking){ seeking=false; }});

      // Playback-Rate
      rateBtns.forEach(b=>{
        b.addEventListener("click", ()=>{
          rateBtns.forEach(x=>{ x.style.fontWeight="400"; x.style.textDecoration="none"; });
          b.style.fontWeight="800"; b.style.textDecoration="underline";
          const r = Math.max(0.8, parseFloat(b.dataset.rate)||1);
          audio.playbackRate = r;
          haptic.tap();
        });
      });
    })();
  </script>
</body>
</html>
